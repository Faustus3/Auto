<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' *.cloudflare.com; img-src 'self' *.cloudflare.com https://via.placeholder.com; style-src 'self' 'unsafe-inline';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <title>Instagram Bild-Genehmigung</title>
    <style>
        :root {
            --primary-color: #405DE6;
            --secondary-color: #5851DB;
            --gradient-start: #833AB4;
            --gradient-mid: #C13584;
            --gradient-end: #E1306C;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
            --success-color: #4CAF50;
            --danger-color: #f44336;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(45deg, var(--gradient-start), var(--gradient-mid), var(--gradient-end));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .approval-container {
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .image-container {
            display: flex;
            overflow-x: auto;
            padding: 20px;
            gap: 20px;
            background-color: #f9f9f9;
        }
        
        .image-card {
            flex: 0 0 auto;
            width: 300px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background-color: white;
            transition: transform 0.3s ease;
        }
        
        .image-card:hover {
            transform: translateY(-5px);
        }
        
        .image-card.selected {
            border: 3px solid var(--primary-color);
        }
        
        .image-preview {
            width: 100%;
            height: 300px;
            object-fit: cover;
            cursor: pointer;
        }
        
        .image-info {
            padding: 15px;
        }
        
        .image-actions {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background-color: #f9f9f9;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        
        .btn-select {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-select:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-delete {
            background-color: #f9f9f9;
            color: var(--danger-color);
        }
        
        .btn-delete:hover {
            background-color: #f1f1f1;
        }
        
        .selected-image {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .selected-image-preview {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .caption-container {
            margin-bottom: 20px;
        }
        
        .caption-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .caption-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            font-size: 1rem;
        }
        
        .approval-actions {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background-color: #f9f9f9;
        }
        
        .btn-approve {
            background-color: var(--success-color);
            color: white;
            padding: 12px 24px;
        }
        
        .btn-approve:hover {
            background-color: #3e8e41;
        }
        
        .btn-reject {
            background-color: var(--danger-color);
            color: white;
            padding: 12px 24px;
        }
        
        .btn-reject:hover {
            background-color: #d32f2f;
        }
        
        .btn-generate {
            background-color: var(--gradient-mid);
            color: white;
            padding: 12px 24px;
            margin-top: 20px;
        }
        
        .btn-generate:hover {
            background-color: var(--gradient-end);
        }
        
        .status-container {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .status-title {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .status-list {
            list-style-type: none;
        }
        
        .status-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-date {
            color: #777;
            font-size: 0.9rem;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .image-card {
                width: 250px;
            }
            
            .image-preview {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Instagram Bild-Genehmigung</h1>
            <p>Generierte Bilder überprüfen und für Instagram freigeben</p>
        </header>
        
        <div class="approval-container">
            <div class="image-container" id="imageGallery">
                <!-- Bilder werden hier dynamisch eingefügt -->
            </div>
            
            <div class="selected-image" id="selectedImageContainer">
                <img src="" alt="Ausgewähltes Bild" class="selected-image-preview" id="selectedImage">
                
                <div class="caption-container">
                    <label for="imageCaption">Bildunterschrift:</label>
                    <textarea id="imageCaption" class="caption-textarea" placeholder="Geben Sie eine Bildunterschrift ein..."></textarea>
                </div>
                
                <div class="approval-actions">
                    <button class="btn btn-reject" id="rejectBtn">Ablehnen</button>
                    <button class="btn btn-approve" id="approveBtn">Genehmigen & Planen</button>
                </div>
            </div>
        </div>
        
        <button class="btn btn-generate" id="generateBtn">Neue Bilder generieren</button>
        
        <div class="status-container">
            <h3 class="status-title">Genehmigte Bilder</h3>
            <ul class="status-list" id="approvedList">
                <!-- Genehmigte Bilder werden hier angezeigt -->
            </ul>
        </div>
    </div>
    
    <script>
        // Beispieldaten - werden später durch echte Daten aus ComfyUI ersetzt
        const sampleImages = [
            { id: 1, url: 'https://via.placeholder.com/300x300?text=Bild+1', timestamp: new Date() },
            { id: 2, url: 'https://via.placeholder.com/300x300?text=Bild+2', timestamp: new Date() },
            { id: 3, url: 'https://via.placeholder.com/300x300?text=Bild+3', timestamp: new Date() },
            { id: 4, url: 'https://via.placeholder.com/300x300?text=Bild+4', timestamp: new Date() }
        ];
        
        const approvedImages = [];
        let selectedImageId = null;
        
        // DOM-Elemente
        const imageGallery = document.getElementById('imageGallery');
        const selectedImageContainer = document.getElementById('selectedImageContainer');
        const selectedImage = document.getElementById('selectedImage');
        const imageCaption = document.getElementById('imageCaption');
        const approveBtn = document.getElementById('approveBtn');
        const rejectBtn = document.getElementById('rejectBtn');
        const generateBtn = document.getElementById('generateBtn');
        const approvedList = document.getElementById('approvedList');
        
        // Anfangs ausblenden
        selectedImageContainer.classList.add('hidden');
        
        // Bilder in die Galerie laden
        function loadImages(images) {
            imageGallery.innerHTML = '';
            
            images.forEach(image => {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.dataset.id = image.id;
                
                card.innerHTML = `
                    <img src="${image.url}" alt="Generiertes Bild" class="image-preview">
                    <div class="image-info">
                        <p>Generiert: ${formatDate(image.timestamp)}</p>
                    </div>
                    <div class="image-actions">
                        <button class="btn btn-select">Auswählen</button>
                        <button class="btn btn-delete">Löschen</button>
                    </div>
                `;
                
                imageGallery.appendChild(card);
                
                // Event-Listener für die Bildauswahl
                const selectBtn = card.querySelector('.btn-select');
                selectBtn.addEventListener('click', () => selectImage(image));
                
                // Event-Listener für das Löschen
                const deleteBtn = card.querySelector('.btn-delete');
                deleteBtn.addEventListener('click', () => deleteImage(image.id));
                
                // Auch das Bild selbst kann angeklickt werden
                const imgElement = card.querySelector('.image-preview');
                imgElement.addEventListener('click', () => selectImage(image));
            });
        }
        
        // Bild auswählen
        function selectImage(image) {
            selectedImageId = image.id;
            selectedImage.src = image.url;
            selectedImageContainer.classList.remove('hidden');
            
            // Alle Karten deselektieren
            document.querySelectorAll('.image-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Ausgewählte Karte markieren
            const selectedCard = document.querySelector(`.image-card[data-id="${image.id}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
            
            // Zu dem ausgewählten Bild scrollen
            selectedImageContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Bild löschen
        function deleteImage(id) {
            const index = sampleImages.findIndex(img => img.id === id);
            if (index !== -1) {
                sampleImages.splice(index, 1);
                loadImages(sampleImages);
                
                // Wenn das ausgewählte Bild gelöscht wurde
                if (selectedImageId === id) {
                    selectedImageContainer.classList.add('hidden');
                    selectedImageId = null;
                }
            }
        }
        
        // Bild genehmigen
        approveBtn.addEventListener('click', () => {
            if (selectedImageId) {
                const image = sampleImages.find(img => img.id === selectedImageId);
                if (image) {
                    const caption = imageCaption.value.trim();
                    
                    // Bild mit Bildunterschrift zu genehmigten Bildern hinzufügen
                    approvedImages.push({
                        ...image,
                        caption,
                        approvedAt: new Date()
                    });
                    
                    // Aus der Galerie entfernen
                    deleteImage(selectedImageId);
                    
                    // Genehmigte Bilder aktualisieren
                    updateApprovedList();
                    
                    // Auswahlansicht zurücksetzen
                    selectedImageContainer.classList.add('hidden');
                    imageCaption.value = '';
                    selectedImageId = null;
                    
                    // Erfolgsmeldung
                    alert('Bild wurde genehmigt und für Instagram geplant!');
                }
            }
        });
        
        // Bild ablehnen
        rejectBtn.addEventListener('click', () => {
            if (selectedImageId) {
                deleteImage(selectedImageId);
                alert('Bild wurde abgelehnt und gelöscht.');
            }
        });
        
        // Neue Bilder generieren
        generateBtn.addEventListener('click', () => {
            // Hier würde die Verbindung zu ComfyUI hergestellt werden
            alert('Verbindung zu ComfyUI wird hergestellt, um neue Bilder zu generieren...');
            
            // Für Demozwecke fügen wir einfach neue Beispielbilder hinzu
            const newImages = [
                { id: sampleImages.length + 1, url: 'https://via.placeholder.com/300x300?text=Neues+Bild+1', timestamp: new Date() },
                { id: sampleImages.length + 2, url: 'https://via.placeholder.com/300x300?text=Neues+Bild+2', timestamp: new Date() }
            ];
            
            sampleImages.push(...newImages);
            loadImages(sampleImages);
        });
        
        // Liste der genehmigten Bilder aktualisieren
        function updateApprovedList() {
            approvedList.innerHTML = '';
            
            if (approvedImages.length === 0) {
                approvedList.innerHTML = '<li class="status-item">Noch keine Bilder genehmigt.</li>';
                return;
            }
            
            approvedImages.forEach(image => {
                const item = document.createElement('li');
                item.className = 'status-item';
                item.innerHTML = `
                    <p>Bild #${image.id} - ${image.caption || 'Keine Bildunterschrift'}</p>
                    <p class="status-date">Genehmigt am: ${formatDate(image.approvedAt)}</p>
                `;
                approvedList.appendChild(item);
            });
        }
        
        // Hilfsfunktion zum Formatieren des Datums
        function formatDate(date) {
            return new Date(date).toLocaleString('de-DE', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Initialisierung
        loadImages(sampleImages);
        updateApprovedList();
        
        // Hier würde später die Integration mit Cloudflare Tunnel, Ollama und ComfyUI erfolgen
        // Beispiel für die Verbindung zu ComfyUI über Cloudflare Tunnel:
        /*
        async function connectToComfyUI() {
            try {
                const response = await fetch('https://comfyui.beispiel.com/api/queue', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        // Workflow-Daten würden hier eingefügt
                    })
                });
                
                const data = await response.json();
                // Verarbeitung der Antwort
            } catch (error) {
                console.error('Fehler bei der Verbindung zu ComfyUI:', error);
            }
        }
        
        // Beispiel für die Verbindung zu Ollama über Cloudflare Tunnel:
        async function generateCaption(imageUrl) {
            try {
                const response = await fetch('https://ollama.beispiel.com/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'llama3',
                        prompt: `Generiere eine kreative Instagram-Bildunterschrift für dieses Bild: ${imageUrl}`,
                        options: {
                            temperature: 0.7
                        }
                    })
                });
                
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Fehler bei der Verbindung zu Ollama:', error);
                return '';
            }
        }
        */
    </script>
    
    <!-- Core application scripts -->
    <script src="static/js/config.js" defer></script>
    <script src="static/js/api.js" defer></script>
    
    <!-- Cloudflare integration -->
    <script src="cloudflare_integration_for_existing_site.js" defer></script>
</body>
</html>
